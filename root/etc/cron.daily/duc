INDEX_DIR='/'
DB_DIR='/'
JSON_DIR='/var/cache'

# directory indexing
duc index $INDEX_DIR --database $DB_DIR/.duc.db

# parse db into xml
duc xml --database=$DB_DIR/.duc.db $INDEX_DIR > tree.xml

# delete not dir nodes and fake folder
sed -i -e '/<ent name=/d' tree.xml
/usr/lib64/utils/xml-remove.py

# xml to json conversion
/usr/lib64/utils/xml2json.py -t xml2json -o data.json tree.xml
rm -rf tree.xml

# prettify json
/usr/lib64/utils/pretty-JSON.py > pretty.json
rm -rf data.json

# delete useless data
sed -i -e '2d' pretty.json
head -n -1 pretty.json > tmp1; mv tmp1 pretty.json
sed -i -e '/#tail/d' pretty.json
sed -i -e '/#text/d' pretty.json

# replace values
sed -i -e 's/ent/children/g' pretty.json
sed -i -e 's/@root/name/g' pretty.json
sed -i -e 's/@name/name/g' pretty.json
sed -i -e 's/@size/size/g' pretty.json

# compress JSON
/usr/lib64/utils/compression.py
mv pretty.json $JSON_DIR/duc.json
